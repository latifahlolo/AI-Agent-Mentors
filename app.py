import streamlit as st
import google.generativeai as genai
import json
import re  # ุงุณุชูุฑุงุฏ ููุชุจุฉ ุงูุชุนุจูุฑุงุช ุงูููุทูุฉ

# ๐ ุฅุนุฏุงุฏ ููุชุงุญ Google Gemini API
genai.configure(api_key="AIzaSyBdIOwS9L2zx090u7HI_i6JyDUPWP1OTvc")  # ุงุณุชุจุฏูู ุจููุชุงุญู ุงูุตุญูุญ



def analyze_project(description):
    """
    ุชุญุณูู ุฏูุฉ ุชุญููู ุงููุดุฑูุน ุจุงุณุชุฎุฏุงู Google Gemini API.
    """
    prompt = f"""
    ๐ฏ **ูููุชู ููุณุงุนุฏ ุฐูุงุก ุงุตุทูุงุนู:**
    ุฃูุช ูููู ุฐูุงุก ุงุตุทูุงุนู ูุณุงุนุฏ ููุชูุฑุฒ Apple Academy ุนูู ุชุญููู ูุดุงุฑูุน ุงูุทูุงุจ ูุงูุชุฑุงุญ ุงูุฃุฏูุงุช ุงูููุงุณุจุฉ.

    โ **ูุตู ุงููุดุฑูุน:**  
    {description}
    
    ๐น **ุชุนูููุงุช ุตุงุฑูุฉ:**
    1๏ธโฃ **ุญุฏุฏ ูุฌุงู ุงููุดุฑูุน** (ูุซู: iOS Development, AI, Cybersecurity, UX/UI).  
    2๏ธโฃ **ุงูุชุฑุญ ุงูุฃุฏูุงุช ูุงูุชูููุงุช ุงูููุงุณุจุฉ** ูููุดุฑูุน.  
    3๏ธโฃ **ูุฏู ูุตูุญุฉ ูุตูุฑุฉ ูุชุญุณูู ุงููุดุฑูุน.**  
    4๏ธโฃ **ูุฌุจ ุฃู ูููู ุงูุฅุฎุฑุงุฌ ุจุตูุบุฉ JSON ููุทุ ุจุฏูู ุฃู ุชูุณูุฑ ุฅุถุงูู.**
    
    ๐ **ูุซุงู ุนูู ุงูุฅุฎุฑุงุฌ ุงูุตุญูุญ:**  
    ```json
    {{
        "category": "AI & Machine Learning",
        "suggested_tools": ["Python", "TensorFlow", "LangChain"],
        "advice": "ุญุงูู ุชุญุณูู ุฌูุฏุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ ูู ุงูุชุฏุฑูุจ."
    }}
    ```
    โ **ูุง ุชุฎุฑุฌ ุฃู ุดูุก ุฎุงุฑุฌ JSON!**
    """

    try:
        model = genai.GenerativeModel("gemini-pro")

        response = model.generate_content(
            prompt,
            generation_config=genai.types.GenerationConfig(
                temperature=0.2
            )
        )

        response_text = response.text.strip()

        # ๐ **ูุญุงููุฉ ุงุณุชุฎุฑุงุฌ JSON ูู ุงููุต ุจุงุณุชุฎุฏุงู ุงูุชุนุจูุฑุงุช ุงูููุทูุฉ (Regex)**
        match = re.search(r'\{.*\}', response_text, re.DOTALL)
        if match:
            json_text = match.group(0)
            return json.loads(json_text)  # ุชุญููู ุงููุต ุฅูู JSON
        
        return {"error": "โ๏ธ ุงููููุฐุฌ ูู ูุฑุฌุน ุงุณุชุฌุงุจุฉ ุจุตูุบุฉ JSONุ ุญุงูู ูุฌุฏุฏูุง."}

    except Exception as e:
        return {"error": f"โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงููุดุฑูุน: {str(e)}"}
st.title("๐ AI Agent ูุชุญููู ุงููุดุงุฑูุน ุงูุทูุงุจูุฉ ุจุงุณุชุฎุฏุงู Google Gemini")

# โ **ุงุฎุชุจุงุฑ ุฃู Streamlit ูุนูู ุจุดูู ุตุญูุญ**
st.write("โ Streamlit ูุนูู ุจุดูู ุตุญูุญ!")

st.write("ุฃุฏุฎู ูุตู ูุดุฑูุน ุงูุทุงูุจ ูุณูุณุงุนุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ุชุตูููู ูุงูุชุฑุงุญ ุฃุฏูุงุช ููุงุณุจุฉ.")

# โ๏ธ ุฅุฏุฎุงู ูุตู ุงููุดุฑูุน ูู ุงููุณุชุฎุฏู
project_description = st.text_area("โ๏ธ ุฃุฏุฎู ูุตู ุงููุดุฑูุน ููุง:", height=150)

if st.button("ุชุญููู ุงููุดุฑูุน ๐"):
    if project_description.strip():
        st.write("๐ **ุฌุงุฑู ุชุญููู ุงููุดุฑูุน...**")

        result = analyze_project(project_description)  # ุชุดุบูู ุงูุชุญููู

        # ๐ **ุนุฑุถ ุงููุชูุฌุฉ ุงูุฃูููุฉ ููุญุต ุฃู ุฎุทุฃ**
        st.write("๐ ุงููุชูุฌุฉ ุงูุฃูููุฉ:", result)

        st.subheader("๐น ูุชูุฌุฉ ุงูุชุญููู:")
        st.json(result)  # ุนุฑุถ ุงููุชูุฌุฉ ุจุตูุบุฉ JSON
    else:
        st.warning("โ๏ธ ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุตู ุงููุดุฑูุน ูุจู ุงูุชุญููู!")
